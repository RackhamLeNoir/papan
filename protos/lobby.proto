syntax = "proto3";
package PapanLobby;

message CreateLobby {
  string lobby_name = 1;
}

message Action {
  oneof action {
    CreateLobby create_lobby = 1;
  }
}

message Error {
  string message = 1;
}

message Subscribed {}

message LobbyInfo {
  string lobby_id = 1;
  string lobby_name = 2;
}

message Update {
  oneof update {
    Error error = 1;
    Subscribed subscribed = 2;
    LobbyInfo lobby_created = 3;
  }
}

message JoinLobby {
  string lobby_id = 1;
}

message Player {
  string player_id = 1;
}

message ChatMessage {
  Player player = 1;
  string message = 2;
}

message LeaveLobby { }

message LobbyAction {
  oneof action {
    JoinLobby join_lobby = 1;
    ChatMessage send_chat_message = 2;
    bool set_ready = 3;
    Player kick_player = 4;
    LeaveLobby leave_lobby = 5;
  }
}

message PlayerReadyUpdate {
  string player_id = 1;
  bool ready = 2;
}

message LobbyUpdate {
  oneof update {
    ChatMessage new_chat_message = 1;
    Player player_joined = 2;
    Player player_left = 3;
    PlayerReadyUpdate player_ready_update = 4;
  }
}

enum LobbyStatus {
  CREATED = 0;
  DESTROYED = 1;
}

message ListLobbiesRequest { }
message ListLobbiesResponse {
  LobbyInfo lobby = 1;
  LobbyStatus status = 2;
}

service PlayerLobbyService {
  rpc Subscribe (stream Action) returns (stream Update);
  rpc Lobby (stream LobbyAction) returns (stream LobbyUpdate);
  rpc ListLobbies (ListLobbiesRequest) returns (stream ListLobbiesResponse);
}
