<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">

<dom-module id="papan-placeholder">
  <template>
    <paper-button on-tap="_connectToLocalLobby">Launch and connect to local lobby</paper-button>
    <div>Connection status: [[_status]]</div>
    <paper-button id="createLobby" disabled on-tap="_createLobby">Create lobby</paper-button>

    <paper-dialog id="lobbyCreation" modal>
      <paper-input id="lobbyName" label="Lobby name" value="My Lobby"></paper-input>
      <paper-button dialog-confirm autofocus on-tap="_validateLobbyName">Create</paper-button>
    </paper-dialog>

    <paper-dialog id="errorMessage" modal>
      <div>[[_errorMessage]]</div>
      <paper-button dialog-confirm autofocus>Close</paper-button>
    </paper-dialog>
  </template>
  <script>
    'use strict'

    Polymer({
      is: "papan-placeholder",

      ready() {
        channel.send('getLobbyConnectionStatus')
        channel.on('error', data => {
          this._errorMessage = data.error.message
          this.$.errorMessage.open()
        })
        channel.on('lobbyConnectionStatus', data => {
          this._status = data.status
          this.$.createLobby.disabled = this._status !== 'CONNECTED'
        })
        channel.on('lobbyCreated', data => {
          console.log(data)
        })
      },

      _connectToLocalLobby: function() {
        channel.send('connectToLobbyServer', { connectLocal: true })
      },

      _createLobby: function() {
        this.$.lobbyCreation.open()
      },

      _validateLobbyName: function() {
        channel.send('createLobby', { lobbyName: this.$.lobbyName.value })
      }
    })

    if (PapanUtils.isElectron()) {
      require('./src/client/renderer.js')
      require('devtron').install()
    }

  </script>
</dom-module>
